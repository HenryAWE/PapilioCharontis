# 脚本
用于控制格式化输出的脚本，是标准库中替换域（replacement field）的超集。其由以下部分组成：
1. 通常字符（除了 `{` 和 `}` 以外的字符）：它们不会受到任何修改，直接被复制到输出中
2. 转义序列 `{{` 和 `}}`：它们在输出中分别被替换为 `{` 和 `}`
3. 替换域和脚本域（见下文）

## 替换域（Replacement Field）
与标准库和 {fmt} 类似，它用于将值插入到输出字符串中，格式如下：
1. `{arg-id}`：没有格式说明的替换域
2. `{arg-id:format-spec}`：有格式说明的替换域

- `arg-id`：格式换参数的索引或名称；若省略，则按照顺序使用参数。在手动指定的参数后使用自动参数会报错。
  可以使用 `[]` 操作符与 `.属性` 来访问其成员，如：`[0]`、`[0:5]`、`['name']` 与 `.size`。详情见 [内建访问器](./builtin_accessor.md) 与 [自定义访问器](./accessor.md)。
- `format-spec`：由对应的 `papilio::formatter` 特化所定义的格式说明。详情见 [内建格式化器](./builtin_formatter.md) 与 [自定义格式化器](./formatter.md)。

## 脚本域（Scripted Field）
脚本域类似于替换域，由一对大括号 (`{}`) 包围，并以 `$` 符号开头。脚本域必须包含条件语句和至少一个分支。条件语句和分支由冒号（`:`）分隔。
例如 `{$ {0} != 0: 'non-'}zero` 和 `{$ {0} != 0: 'non-zero' : 'zero'}` 含有有效的脚本域。

### 条件语句
条件语句是一个布尔表达式，可以是比较、逻辑非或可转换为 `bool` 的值。条件语句中的值可以是格式参数（`format_arg`）或常量值。

1. 参数与常量
   - 参数：通过没有格式说明的替换域引用参数
   - 字符串：通过单引号（`'`）包裹，并用转义序列包含特殊字符：
     | 转义序列                  | 结果          |
     | ------------------------- | ------------- |
     | `\'`                      | `'`（单引号） |
     | `\\`                      | `\`           |
     | `\c`（`c`为任意其他字符） | `c`（不转换） |

   - 浮点数与整数：`3.14`、`10` 等

2. 比较
    | 操作符 | 含义     |
    | -----: | :------- |
    |   `==` | 等于     |
    |   `!=` | 不等于   |
    |    `>` | 大于     |
    |    `<` | 小于     |
    |   `>=` | 大于等于 |
    |   `<=` | 小于等于 |

3. 逻辑非
   逻辑非前面有感叹号 (`!`)，只有一个操作数。

4. 可转换为 `bool` 的值
   非零数值和非空字符串被视为 `true`，否则被视为 `false`。

### 分支
当条件语句求值为 `true` 时，执行第一个分支，否则执行后续的分支。对于只有一个分支的脚本域，条件语句求值为 `false` 时不会产生任何输出。

分支语句的执行结果为输出一个字符串，字符串的定义方法同条件语句。也可以用替换域作为分支的结果。

#### 多分支
用于处理复杂的输出。

语法：`{$ 条件-1: 结果-1 : $ 条件-2: 结果-2: 结果-3}`

| `条件-1` | `条件-2` |  结果  |
| :------: | :------: | :----: |
|  `true`  |  `true`  | 结果-1 |
|  `true`  | `false`  | 结果-1 |
| `false`  |  `true`  | 结果-2 |
| `false`  | `false`  | 结果-3 |
